from pathlib import Path


configfile: "config/config.yaml"


WORKFLOW = Path("workflow").resolve()
RULES = WORKFLOW / "rules"
ENVS = WORKFLOW / "envs"
SCRIPTS = WORKFLOW / "scripts"
RESULTS = Path("results").resolve()
BENCH = RESULTS / "benchmark"
LOGS = Path("logs/rules").resolve()
CONTAINERS = config["containers"]
RESOURCES = Path("resources").resolve()
GB = 1_000
EXTENSIONS = {"gzip": "gz", "bzip2": "bz2", "xz": "xz", "zstd": "zst"}
combos = []
target_files = set()

nanopore_accession = config["accessions"]["nanopore"]
illumina_accession = config["accessions"]["illumina"]
for tool, rng in config["compression_level_ranges"].items():
    s = rng[0]
    e = rng[-1]
    ext = EXTENSIONS[tool]
    for lvl in range(s, e + 1):
        target_files.add(
            BENCH / f"decompress/{tool}/{lvl}/nanopore/{nanopore_accession}.tsv"
        )
        combos.append([tool, lvl, "nanopore", nanopore_accession])
        target_files.add(
            BENCH / f"decompress/{tool}/{lvl}/illumina/{illumina_accession}.tsv"
        )
        combos.append([tool, lvl, "illumina", illumina_accession])

target_files.add(RESULTS / "compress/sizes.csv")

localrules:
    all, aggregate_sizes


rule all:
    input:
        target_files,


include: RULES / "download.smk"
include: RULES / "compress.smk"
include: RULES / "decompress.smk"
include: RULES / "report.smk"
